# ห้ามใส่บรรทัด shebang และ husky.sh (ตามคำเตือน)

echo "🔎 pre-push: typecheck + quick tests"

# 1) TypeScript typecheck (ไว และพอตรวจพลาดหยุดทันที)
yarn typecheck || exit 1

# 2) Quick tests
#   - เรียก 'yarn jest' โดยตรง (เลี่ยงซ้ำ --config จากสคริปต์ yarn test)
#   - ใช้ --changedSince ถ้ามี origin/main เพื่อรันทดสอบเฉพาะที่เปลี่ยน
if git rev-parse --verify origin/main >/dev/null 2>&1; then
  BASE=$(git merge-base HEAD origin/main)
  yarn jest --passWithNoTests --bail --changedSince="$BASE" --maxWorkers=50% || exit 1
else
  yarn jest --passWithNoTests --bail --maxWorkers=50% || exit 1
fi
